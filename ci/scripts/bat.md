# bat

#### 三、使用记录

##### 3.1、 截取字符串的内容

%date:~0,4%   截取date字符串，从第0个字符开始，截取4个

##### 3.2、call和start启动脚本的区别

start命令：批处理中调用外部程序的命令（该外部程序在新窗口中运行，批处理程序继续往下执行，不理会外部程序的运行状况）

CALL命令：可以在批处理执行过程中调用另一个批处理，当另一个批处理执行完后，再继续执行原来的批处理；同一进程，变量互通。

​		一是调用范围不同：call主要用来进行批处理的内部调用，如call :pend 和一些dos命令的调用如call set test=2，但也可以调用其他可执行文件，而start则不能进行内部调用，但其可以执行基本上所有的外部程序，还可以执行shell，如打开文件夹start "" "%WINDIR%"，安装网络打印机start "" "\\IP\Printer"等等。

　　二是调用方式不同：call是严格意义上而言的调用，在call另一个批处理时是在同一窗体进程里执行，而start则是执行，所以在执行另外一个批处理时是在不同的窗体进程里进行，也就是说在新开启的进程里执行，虽然start可以加入b参数，但其结果却完全不同。如我们使用call set test=2 和 start /b set test=2 看似执行的结果相同，但是我们发现后者有两个进程，而且在窗体里要执行两次exit才能退出，所以当我们使用start来执行一个批处理后最好在被调用的批处理中也加一个exit，否则无法退出被调用的批处理的dos窗体，但是使用call调用时如果在被调用的批处理中存在exit则会直接结束原始和被调用的批处理程序，这是一个非常严重的问题。建议在被调用的批处理中使用goto :eof来取代exit。

　　三是调用结果不同：call调用不仅可以把参数或变量传给被调用的批处理，而且被调用的批处理也可以设置参数或变量以便回传，而start只能把参数或变量传给被调用的批处理，却不能回传参数或变量，这一点实际上是第二点的延伸。另外，我们还必须注意一点：使用call调用其他批处理时，在被调用的批处理中若我们使用goto命令的时候，建议要使用与原批处理中不同的标签名来跳转，否则可能会跳转到原批处理中而不能保证完整的执行被调用批处理中的所有语句。

##### 3.3、环境变量扩展(变量替换)与延迟环境变量扩展

```powershell
setloacl ENABLEDELAYEDEXPANSION
```

CMD在解释命令时,首先会把一条完整的命令进行读取,然后进行匹配操作,匹配时他会把命令里的变量用变量的值个替换掉,然后执行这个替换好的命令.

​	问题就出在\"一条完整的命令\",在BAT中,IF FOR这样的命令都可以加括号,将一些命令嵌套在里面执行.这样的话对于一条可以加扩号嵌其他命令的命令,他的完整格式就是for %%i in (....)这样一个整体.此时,如果我们如果在括号里面嵌入一些设置变量值的命令,就会出现问题了!在循环和条件判断经常要打开延迟环境变量扩展。

​	打开延迟环境变量扩展后，!var!和%var%的作用是一样的。

##### 3.4、关于%~的意义

%~dp0 当前脚本所在的路径 %0代表文件本身，d代表盘符，p代表路径

%~f0 完整的路径+文件名

%~n0 - 文件名(无扩展名)

##### 3.4、

